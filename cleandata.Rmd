---
title: "CleanDataa"
output: html_document
date: "2022-11-19"
---
#CODIGO DE LIMPIEZA: DEPENDIENTE
```{r}
library(rio)
library(htmltab)
depe=import("https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/vardepe.xlsx?raw=true")
```
#elimiar columas 
```{r}
depe[,c(1,4,5,6,7,8,9,10,11,13)]=NULL
```
#cambiar nombres de las filas:
```{r}
newNames=c('prov','electores','partido','votoscas','porcentaje')
names(depe)=newNames
```
#filtrar las filas y crear una nueva base de datos
```{r}
library(dplyr)
depe=filter(depe,partido=="PARTIDO POLITICO NACIONAL PERU LIBRE")
depe[,c(3)]=NULL
```


####(corregido) No pueden trabajar con el número de votos, deben trabajar con el porcentaje (sin el %) de votos válidos que obtuvo PC. Ese cálculo deben hacerlo (similar al que hicimos para el ejemplo de hoy)







variables indepe 1: variable de poblaciòn según ciclo de vida, JOVENES ENTRE 18 Y 29 ANOS   

#(corregido)Asumo que esta es la variable de poblaciòn según ciclo de vida? En caso sea así, esos números representan al total de jóvenes? ¿qué grupos de edades evalúan aquí? No me queda nada claro
```{r}
inde1=import("https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/variables%20independientes/Angelo/variable1.xlsx?raw=true")
```
#eliminar columnas 
```{r}
inde1[,c(1,2,6,7,8,10,11,12)]=NULL
```
#filtrar las filas y crear una nueva base de datos
```{r}
inde1=filter(inde1,!is.na(inde1$...3))
```
#volver a filtrar fila
```{r}
inde1=inde1[-1,]
```
#formatear
```{r}
inde1[,2:4]=lapply(inde1[,2:4],as.numeric)
```
#porcentaje
```{r}
inde1$total=rowSums(inde1[,c(2,3)],na.rm = TRUE)
inde1$pobla=inde1$...9/inde1$total
```

```{r}
inde1[,c(2:5)]=NULL
```


#cambiar nombres de las filas:
```{r}
newNames1=c('prov','poblacionjoven')
names(inde1)=newNames1
```








#variables indepe 2
```{r}
inde2=import("https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/variables%20independientes/Angelo/variable2.xlsx?raw=true")
```
#elimiar columas 
```{r}
inde2[,c(1,2,7)]=NULL
```
#filtrar las filas y crear una nueva base de datos
```{r}
inde2=filter(inde2,!is.na(inde2$...3))
inde2=inde2[-1,]
```
#porcentaje
```{r}
inde2[,2:4]=lapply(inde2[,2:4],as.numeric)
inde2$total=rowSums(inde2[,c(2,3)],na.rm = TRUE)
inde2$sabeleer=inde2$...6/inde2$total
```
#elimiar columas
```{r}
inde2[,c(2:5)]=NULL
```
#cambiar nombres de las filas:
```{r}
newNames3=c('prov','sabeleer')
names(inde2)=newNames3
```

## (corregido) Igual que en el caso de la variable dependiente, no te sirve de nada trabajar con el nùmero. Debes calcular un %. También debes quedarte con una sola variable. Ejemeplo: "te quedas con "sabe leer" y sacas el % y trabajas en base a ello. Tu hipòtesis serìa "a mayor porcentaje de personas que saben leer, menor es el porcentaje del voto hacia Castillo"

#variables indepe 3
```{r}
inde3=import("https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/variables%20independientes/Angelo/variable3.xlsx?raw=true")
```
#filtrar las filas y crear una nueva base de datos
```{r}
inde3=filter(inde3,!is.na(inde3$...3))
inde3=inde3[-1,]
```
#camiar la forma
```{r}
inde3[,4:11]=lapply(inde3[,4:11],as.numeric)
```
#sumar colu y crear una nueva
```{r}
inde3$suma=rowSums(inde3[,c(4:11)],na.rm = TRUE)
```
#porcentaje
```{r}
inde3$noTieneRel=inde3$...7/inde3$suma
```

#elimiar columnas
```{r}
inde3[,c(1,2,4,5,6,7,8,9,10,11,12)]=NULL
```
#cambiar nombres de las colum:
```{r}
newNames4=c('prov','noTieneRel')
names(inde3)=newNames4
```

# (corregido)mismo comentario que la variable anterior
# (corregido)En general, recuerden que DEBEN ESPECIFICAR CUÁL ES CADA VARIABLE. Ejemplo:
1. Variable independiente 1: Porcentaje de personas que saben leer 

#CODIGO DE LIMPIEZA: MAJO
```{r}
library (rio)
library(htmltab)
```

## 2. LIMPIEZA DE LA VARIABLES INDEPENDIENTES

### *2.1.1 Variable independiente: Energía o combustible que utiliza para cocinar: Gas (balón GLP) -- "gas*

```{r}
gas=import("https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/variables%20independientes/Majo/gas.xlsx?raw=true")
```


#porcentaje
```{r}
gas$total=rowSums(gas[,c(3,4)],na.rm = TRUE)
gas$gas=gas$`Sí usa gas (balón GLP)`/gas$total
```


#### Eliminamos las columnas

```{r}
gas[,c(1,3,4,5)]=NULL
```

#### Renombramos

```{r}
names(gas)= c("prov", "gas")
```

```{r}
str(gas)
```





### *2.1.2 Variable independiente: Poblacion afiliada al Seguro Integral de Salud -- "sis"*

```{r}
sis=import("https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/variables%20independientes/Majo/sis.xlsx?raw=true")
```

```{r}
sis$total=rowSums(sis[,c(3,4)],na.rm = TRUE)
sis$sis=sis$`Sí, afiliado al SIS`/sis$total
```


```{r}
sis[,c(1,3,4,5)]=NULL
```

#### Renombramos

```{r}
names(sis)= c("prov", "sis")
```

```{r}
str(sis)
```








### *2.1.3 Asiste a algún colegio, instituto o universidad -- "acsedu"*

```{r}
acsedu=import("https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/variables%20independientes/Majo/acsedu.xlsx?raw=true")
```

#porcentaje
```{r}
acsedu$total=rowSums(acsedu[,c(3,4)],na.rm = TRUE)
acsedu$acsedu=acsedu$`Sí asiste a algún colegio, instituto o universidad`/acsedu$total
```

```{r}
acsedu[,c(1,3,4,5)]=NULL
```

#### Renombramos

```{r}
names(acsedu)= c("prov", "acsedu")
```

#LIMPIEZA DE BASE: MARIA 
1) Importamos la data 
VARIABLE INDEPENDIENTE
```{r}
library(rio)
lkXLSX="https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/variables%20independientes/Maria/Servicio%20de%20Agua%20todo%20los%20dias.xlsx?raw=true"
agua=import(lkXLSX)
```


```{r}
library(rio)
lkXLSX="https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/variables%20independientes/Maria/Alumbrado%20electrico.xlsx?raw=true"
alumbrado=import(lkXLSX)
```

```{r}
library(rio)
lkXLSX="https://github.com/MajoMurillo/Estadistica2---Trabajo/blob/main/variables%20independientes/Maria/Etniticidad.xlsx?raw=true"
etniticidad=import(lkXLSX)
```


2) LIMPIAMOS LA DATA 
#Alumbrado electrico
- Eliminar columnas


```{r}
alumbrado[,c(1,2)]=NULL
```

Eliminar filas 
```{r}
alumbrado=filter(alumbrado,!is.na(alumbrado$...3))
alumbrado=alumbrado[-c(1),]

```

- cambiamos nombres `

VI: ALUMBRADO

Cambiamos el nombre:

```{r}
names=c('prov','Luz','LuzN')
names(alumbrado)=names 
```
#formatear

```{r}
str(alumbrado)
alumbrado$Luz=as.numeric(alumbrado$Luz)
alumbrado$LuzN=as.numeric(alumbrado$LuzN)
```


```{r}
alumbrado$total=rowSums(alumbrado[,c(2,3)],na.rm = TRUE)
alumbrado$alumbrado=alumbrado$Luz/alumbrado$total
```

```{r}
alumbrado[,c(2,3,4)]=NULL
```


#VI:AGUA

- Eliminamos columnas 

```{r}
agua[,c(1,2)]=NULL
```
Eliminamos filas y casos perdidos
```{r}
agua=filter(agua,!is.na(agua$...3))
agua=agua[-c(1),]

```
- Cambiamos el nombre:

```{r}
names1=c('prov','Ag','AgN')
names(agua)=names1 
```

Volvemos numérica
```{r}
agua$Ag=as.numeric(agua$Ag)
agua$AgN=as.numeric(agua$AgN)
```


```{r}
agua$total=rowSums(agua[,c(2,3)],na.rm = TRUE)
agua$agua=agua$Ag/agua$total
```

```{r}
agua[,c(2,3,4)]=NULL
```




#VI: ETNITICIDAD

- Eliminamos columnas 
```{r}
etniticidad[,c(1,2)]=NULL
```

-Eliminamos filas 
```{r}
etniticidad=filter(etniticidad,!is.na(etniticidad$...3))

etniticidad=etniticidad[-c(1),]
```

- pasamos a numérica 
```{r}
etniticidad[,2:12]=lapply(etniticidad[,2:12],as.numeric)
str(etniticidad)
```

SUMAMOS las columnas:

```{r}
etniticidad$suma=rowSums(etniticidad[,c(2,3,4,5,6,11,12)],na.rm = TRUE)
etniticidad$sumano=rowSums(etniticidad[,c(7,8,9,10)],na.rm = TRUE)
```

Eliminamos las columnas que no nos sirven 
```{r}
etniticidad[,c(2:12)]=NULL
```

Renombramos 
```{r}
names2=c('prov','Ln','LnN')
names(etniticidad)=names2 
```
#porcentaje

```{r}
etniticidad$total=rowSums(etniticidad[,c(2,3)],na.rm = TRUE)
etniticidad$etniticidad=etniticidad$Ln/etniticidad$total
```

```{r}
etniticidad[,c(2,3,4)]=NULL
```

#UNIMOS LAS BASES DE LAS VI 
### Merge de las variables independientes


```{r}
setdiff(gas$prov, sis$prov)
sisgas=merge(gas, sis)

```

```{r}
setdiff(sisgas$prov, acsedu$prov)
```

```{r}
indepMajo=merge(sisgas, acsedu)
head(indepMajo)
```

```{r}
Basefinal=merge(agua,alumbrado)
```
```{r}
Basefinal1=merge(Basefinal,etniticidad)
```
```{r}
b1 = merge(inde1,inde2)
b2 = merge(b1,inde3)
```
```{r}
b3=merge(b2,Basefinal1)
data=merge(b3,indepMajo)
```


Limpiamos la base de datos- cambio de nombre:
```{r}
library(stringr)
data$prov=str_split(string = Basefinal1$prov,
                          pattern = ':',
                          simplify = T)[,2]
data$prov=toupper(data$prov)
```

```{r}
data$prov =trimws(data$prov,which=c("right"),whitespace = "[\\h\\v]")
data$prov =trimws(data$prov,which=c("left"),whitespace = "[\\h\\v]")
```
#unir la data de las independientes con la dependiente 
```{r}
setdiff(data$prov,depe$prov)
library(stringi)
data$prov=stri_trans_general(str = data$prov, 
                               id = "Latin-ASCII")
depe$prov=stri_trans_general(str = depe$prov, 
                               id = "Latin-ASCII")
```

```{r}
data[9,1]="ANTONIO RAIMONDI"
data[100,1]="NASCA"

data[145,1]="MANU"
data[146,1]="TAHUAMANU"
data[147,1]="TAMBOPATA"
data[162,1]="CALLAO"
```


```{r}
base=merge(data,depe)
```


```{r}
library(rio)
export(base, "cleandatafinal.csv") 
```